# -*- coding: utf-8 -*-
"""Final DS 220 Project

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1PyAAknNgOPK9f3novBkJv4DJp_E6nJ69

# DS 220 Project #2: Sleep Health and Lifestyle
By James DiPasquale, Otis Murray, Felicia Vijayarangam, Linh Tran, Rachel Desulme, and Nathan Oyeniyi
"""

#Mount Google drive
from google.colab import drive
drive.mount('/content/drive')

my_path = "/content/drive/MyDrive/Colab Notebooks/Sleep_health_and_lifestyle_dataset.csv"

"""***Let's begin by importating the libraries we will use for this analysis.***

**pandas (pd)** *provides methods & classes for tabular and time-series data, and represents datasets with the DataFrame type*

**numpy (np)** *includes functions and classes that aid in numerical computation*

**matplotlib.pyplot (plots)** *allows creation of data visualizations (graphs and charts)*
```
import pandas as pd
import numpy as np
import matplotlib.pyplot as plots
```
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
plt.style.use('fivethirtyeight')

"""The dataset retrieved from the path will be called under the **data** variable for initial exploration, before wrangling.
```
data = pd.read_csv(my_path)
```

**ABOUT THE SLEEP HEALTH AND LIFESTYLE DATASET**

*This is a wide range of cases of individuals in the workforce including variables containing features contributing to sleep metrics, lifestyle factors, cardiovascular health, as well as the occurence of sleep analysis.*
*With this, we can presume that the information has potential to provide insight on lifestyle habits.*

We intend on addressing these questions through investigation and analysis:

1. How does sleep duration vary between different age groups?
2. Is there a correlation between physical activity levels and sleep quality?
3. Which occupations have the lowest and highest average sleep duration?
4. Are ther correlations between occupation and sleep disorders?
5. Are there correlations between stress levels and sleep quality?
6. What are the variations in sleep quality from those in different occupations?
7. Any significant differences in sleep quality between genders?
"""

data = pd.read_csv(my_path)

"""##**EXPLORING THE DATASET**

*Let's preview of the first 10 cases using:*
```
data.head()
```
"""

#First 10 cases
data.head(10)

"""*We can observe the columns using:*
```
data.columns
```
"""

#Viewing all columns
data.columns

"""*Let's display the shape of the Sleep Health and Lifestyle Dataset using:*

```
data.shape
```


"""

#Shape of the dataset
data.shape

"""*This indicates 347 cases with each case being an individual, along with 13 attributes, indeed a wide set of information.*

##**CLEANING AND PREPROCESSING THE DATASET**

*Based on our questions, there are several columns in the dataset not needed for our analysis, therefore we can go through the process of subsetting the dataset into a dataframe we can draw information from.*

*Those columns include:*
- **BMI category** *(column index[8])*
- **Blood Pressure** *(column index[9])*
- **Heart Rate** *(column index[10])*
- **Daily Steps** *(column index[11])*

*The **Person ID** (column index [0]) can also be removed from the dataset due to its redundancy, the index column is sufficient.*

*We can subset the columns we need for analysis using the `iloc` method and retrieving the necessary columns by their index, and assigning the dataframe to a new variable **df**, like so:*
```
df = data.iloc[,:[1,2,3,4,5,6,7,12]]
```
"""

df = data.iloc[:,[1,2,3,4,5,6,7,12]]
df

"""*Now we can observe the dataframe with our columns in focus and start with our cleaning. Let's check if there are any null-values in the dataset. We can do this using the `isnull().sum()` method:*
```
df.isnull()sum()
```
"""

df.isnull().sum()

"""*Looking at the **Sleep Disorder** column, we can observe that there are 219 null instances. We can assume this means that there are no sleep disorders observed for those individuals.*

*We can edit this column and use the `fill.na()` method and replace that null value with a word like "None".*
```
df['Sleep Disorder'] = df['Sleep Disorder'].fillna("None")
```
"""

df = df.copy()
df['Sleep Disorder'] = df['Sleep Disorder'].fillna("None")

#Re-checking for null values
df.isnull().sum()

"""*We can see there are no null values present after filling in the instance with "None".*
*Let's check **df** for duplicate values using:*
```
df.duplicated().sum()
```
"""

#Number of duplicates
df.duplicated().sum()

"""*There are 242 duplicated values (that's 67%!) in our dataset. This indicates individuals with the same instances under the variables, essentially with the same lifestyle and health values. To produce more representative visualizations, we can remove these duplicates.*"""

df = df.drop_duplicates()

#Re-checking number of duplicates
df.duplicated().sum()

#New shape of our dataframe
df.shape

#Preview of the dataframe
df.head(10)

"""*Notice that removing the duplicated rows did not change our indexes, they stayed the same. We can fix this using the `reset_index()` method and it will set a new integer index starting from 0.*
```
df.reset_index(drop=True)
```
"""

df = df.reset_index(drop=True)
df.head(10)

"""***With the index back in order, and no duplicates or null values present, this dataframe is prepared and ready to work with for analysis.***

##**EXPLORATORY DATA ANALYSIS**

*There are multiple methods one can apply to analyze the statistics of a column. We will be using the `describe()` method to obtain the count, mean, standard deviation, mininum, 1st Quartile, 2nd Quartile (median), 3rd Quartile, and maximum values. Placing it in a dataframe using `pd.DataFrame()` would enhance the visualization.*
"""

#Descriptive Statistics on Sleep Duration
sleepDur_eda = df['Sleep Duration'].describe()
sleepDur_edaDF = pd.DataFrame(sleepDur_eda).transpose()
sleepDur_edaDF

"""*One of the factors worth analyzing is the Sleep Duration. From the table, we can see that the mean amount of hours of sleep that these individuals get is 7.08, just around the recommended average from experts. The minumum amount of sleep an individual from this set gets is 5.8 hours of sleep, which is an unhealthy amount, and possibly could be attributed to the demands of their occupation. On the other hand, the maximum amount of sleep is 8.5, possibly connected to the low demands of their occupation.*

"""

#Descriptive Statistics on Physical Activity Level
physAct_eda = df['Physical Activity Level'].describe()
physAct_edaDF = pd.DataFrame(physAct_eda).transpose()
physAct_edaDF

"""***Physical Activity Level*** *indicates the number of minutes per day an individual spends engaging in physical activity. The average among the individuals in the dataset is almost an hour, 30 minutes being the minimum amount, and 1 hour and 30 minutes as the maximum time recorded. Physical activity is generally known to contribute to the quality and duration of one's sleep. It can leave one feeling more tired at the end of the day, which can result in less interrupted sleep pattern and ultimately higher quality of sleep. In this dataset, we can propose that those with high physical acitivty levels have higher quality of sleep and possibly sleep longer.*

##**RESEARCH QUESTIONS & INSIGHTS**

**Question 1: How does sleep duration vary across different age groups?**
"""

plt.scatter(df['Age'], df['Sleep Duration'])
plt.xlabel('Age')
plt.ylabel('Sleep Duration (hours)')
plt.title('Age vs Sleep Duration')
plt.show()

"""**Code Explanation**

*The block of code creates a scatter plot using the `plt.scater()` function. It takes the **Age** and **Sleep Duration** columns as the x and y axis, respectively. The following lines adds labels to the axis and a title to the plot, and `plt.show()` displayes the plot.*

**Analysis**

*This scatterplot shows a somewhat positive correlation, those who are older get the most amount of sleep and the younger individuals get the least amount. However, there are several instances of younger individuals getting a good amount of sleep and middle-aged individuals with little sleep, so it is likely that age is not most important factor to consider when analyzing sleep duration. It is likely that occupation would display a stronger correlation.*

**QUESTION 2: Is there correlation between physical activity levels and sleep quality?**
"""

df['Quality of Sleep'] =( df['Quality of Sleep'] - df['Quality of Sleep'].mean() ) / df['Quality of Sleep'].std()

#Standardize units for comparison
df['Physical Activity Level'] =( df['Physical Activity Level'] - df['Physical Activity Level'].mean() ) / df['Physical Activity Level'].std()

#Physical activity levels vs Sleep Quality
ax1 = df.plot.scatter(x='Quality of Sleep', y='Physical Activity Level',c='DarkBlue')
plt.title('Quality of Sleep vs Physical Activity Level')

#Correlation between Quality of Sleep vs. Physical Activity Level
df['Quality of Sleep'].corr(df['Physical Activity Level'])

"""**Code Explanation**

*The code standardizes the 'Quality of Sleep' and 'Physical Activity Level' columns in the dataframe using Z-score normalization, scaling the data to a mean of zero and a standard deviation of one. This allows for direct comparison between the two variables. It then generates a scatter plot with the standardized values, plotting sleep quality on the x-axis and physical activity level on the y-axis, using dark blue for the data points. The plot is titled 'Quality of Sleep vs Physical Activity Level'. Finally, it calculates the correlation coefficient between these variables, providing a measure of their linear relationship. The magnitude of the correlation coefficient indicates the strength of the relationship.*

**Analysis**

*The correlation coefficient of roughly 0.29 indicates a weak positive association between sleep quality and physical activity level. This suggests that, to some extent, better sleep quality is linked to increased physical activity. However, the strength of this link is not strong, showing that other factors may play an important role in determining physical activity levels and that sleep quality alone is not a powerful predictor.*

**QUESTION 3: Which occupations have the highest and lowest average sleep duration?**
"""

#Occupation vs Average Sleep Duration
grouped = df.groupby('Occupation')

avg_sleep_occ = grouped['Sleep Duration'].mean()
avg_sleep_occ

# Plot the results with horizontal bars
plt.figure(figsize=(10, 6))
avg_sleep_occ.plot(kind='barh', color='skyblue')  # Change 'bar' to 'barh' for horizontal bars
plt.title('Average Sleep Duration by Occupation')
plt.xlabel('Sleep Duration')
plt.ylabel('Occupation')
plt.show()

"""**Code Explanation**

*This code analyzes the relationship between occupation and average sleep duration. It calculates mean sleep duration for each occupation using `.groupby()` and `.mean()` methods. The results are stored in a Series object, avg_sleep_occ. A 10x6 inch bar chart is created, labeled 'Average Sleep Duration by Occupation'. The plot is displayed using plt.show(), allowing easy comparison of sleep duration across different occupations.*

**Analysis**

*In analyzing sleep durations by occupation, Engineers have the highest average at 7.8 hours, while Sales Representatives have the lowest at 5.9 hours. Sleep times vary significantly across professions, generally ranging from about 6 to 7 hours per night, with technical and healthcare roles often experiencing slightly higher sleep durations.*

**QUESTION 4: Are there correlations between occupation and sleep disorders?**
"""

grouped_data = data.groupby(['Occupation', 'Sleep Disorder']).size().unstack(fill_value=0)

# Create a bar graph to visualize the relationship
plt.figure(figsize=(10, 6))
grouped_data.plot(kind='bar', stacked=True)
plt.title('Correlation between Occupation and Sleep Disorders')
plt.xlabel('Occupation')
plt.ylabel('Count of Sleep Disorders')
plt.legend(title='Sleep Disorders')

"""**Code Explanation**

*This code examines the correlation between multiple occupations and the occurrences of different sleep disorders, in this case insomnia and sleep apnea. The code begins by grouping the data into both sleep disorder and ocupation columns, it also determines the size of both groups to find the frequencies of each sleeping disorder. After organizing the results they are used to create a 10x6 inch bar chart that shows the distribution of different sleeping disorders among those who are employed under the distinct occupations. The code then uses functions like .title, .xlabel, and .ylabel to add titles to the graph making it easier to understand. Lastly, we used the .legend function so we could differentiate between the two different sleeping disorders represented by the colors red and blue.*

**Analysis**

*According to the data illustrated in this graph, nurses have a notably higher prevalence of reported sleep apnea compared to people in other occupations. Moreover, salespersons and teachers also demonstrate elevated levels of reported insomnia. Conversely, professions such as sales representatives, scientists, and software engineers appear to experience substantially lower incidences of sleep disorders.*

**QUESTION 5: Are there correlations between stress levels and sleep quality?**
"""

grouped_data = data.groupby(['Stress Level', 'Quality of Sleep']).size().unstack(fill_value=0)


# Create a bar graph to visualize the relationship
plt.figure(figsize=(10, 6))
grouped_data.plot(kind='bar', stacked=True)
plt.title('Correlation between Stress Levels and Sleep Quality')
plt.xlabel('Stress Level')
plt.ylabel('Count of Sleep Quality')
plt.legend(title='Sleep Quality')
plt.show()

"""**Code Explanation**

*The code groups the dataset by 'Stress Level' and 'Quality of Sleep', counting entries for each group and reshaping the data with unstack. A stacked bar chart is then created to visualize how sleep quality varies with stress levels.*

**Analysis**

*The bar graph clearly shows the association between stress levels and sleep quality. As stress levels rise from '3' to '8', there appears to be a shift in sleep quality, with higher stress levels being associated with lower sleep quality. At lower stress levels, the most common sleep quality rating is higher (shown by the color '9'), whereas at higher stress levels, the distribution of sleep quality moves to lower ratings (colors '4' and '5'). This graphic data indicates a negative correlation: when stress levels rise, sleep quality declines.*

**QUESTION 6: What is the relationship between Sleep Disorders and BMI Category:**
"""

#change the data entries 'Normal Weight' in the BMI Category column to all equal to 'Normal'
data['BMI Category'] = data['BMI Category'].replace('Normal Weight', 'Normal')
grouped_data = data.groupby(['BMI Category', 'Sleep Disorder']).size().unstack(fill_value=0)

#make the graph of relationship between sleep disorders sep
plt.figure(figsize=(8, 6))
grouped_data.plot(kind='bar', stacked=True)
plt.title('Relationship between Sleep Disorders and BMI Category')
plt.xlabel('BMI Category')
plt.ylabel('Count of Sleep Disorders')
plt.legend(title='Sleep Disorder')
plt.show()

"""**Code Explanation**

*This code snippet updates a dataset and illustrates the association between BMI categories and sleep disorders. It initially standardizes the 'BMI Category' by changing 'Normal Weight' to 'Normal'. The data is then grouped by 'BMI Category' and 'Sleep Disorder', with zeros replacing missing values. A stacked bar chart is generated, showing the number of sleep problems in each BMI category and allowing for comparative analysis.*

**Analysis**

*According to the data in this graph we can see that being overweight tends to put you at a higher risk of having sleep disorders such as insomnia and sleep apnea. The obese category seems to have a lower rate of having sleep disorders but that is probably because there were not that many obese people in the data set. Therefore, it was hard to tell if being obese had more of an effect on having sleep disorders compared to the other weight categories normal and overweight. Additionally, it appeared as though the distribution of sleep disorders within each weight class was even, meaning the sleep disorders insomnia and sleep apnea are not very different when it comes to whether a person has one or the other.*

**QUESTION 7: Any significant differences in sleep quality between genders?**
"""

plt.figure(figsize=(8, 6))
data.boxplot(column='Quality of Sleep', by='Gender')
plt.title('Comparison of Sleep Quality by Gender')
plt.suptitle('')
plt.xlabel('Gender')
plt.ylabel('Sleep Quality')
plt.show()

"""**Code Explanation**

*This code creates a boxplot comparing sleep quality distributions by gender, segmenting data by gender, and providing titles and labels. It visually shows differences in sleep quality across genders, including medians and outliers.*

**Analysis**

*The graph illustrates a clear trend showing that females, on average, attain more sleep than males. The distribution of female sleep quality leans towards the right, signaling a prevalence of higher quality sleep among women. While male sleep quality follows a more standard bell curve distribution, centered around an average quality of sleep. These observations provide valuable insights into the differing sleep patterns between genders and suggest potential underlying factors contributing to these distinctions.*

##**CONCLUSION**

*In conclusion, we were able to wrangle the data using pandas functions. We were also able to explore the statistics of a couple variables (Sleep Duration and Physical Activity Level) to scope out the variations among the individuals and potential correlations for why individuals would get lower than the recommended amount to sleep and have high stress levels. The graphs illustrate the interrelationships among various variables within our dataset and how they correlate. Through our visual representations, we could explore different trends and compare them to real-life scenarios. We can acknowledge the insight we’ve gained and apply it to our own lives as we prepare to enter the workforce, hopefully with managed stress and good sleep.*
"""